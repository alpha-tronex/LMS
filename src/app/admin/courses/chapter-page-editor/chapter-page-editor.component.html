<section class="masthead bg-primary text-white text-center">
  <div class="container">
    <app-admin-breadcrumb></app-admin-breadcrumb>

    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2 class="mb-0">{{ titleText }}</h2>
      <div class="btn-group" role="group">
        <button class="btn btn-outline-light btn-sm" (click)="backToCourseContent()">
          <i class="fas fa-arrow-left"></i> Back
        </button>
      </div>
    </div>

    <div class="card text-dark">
      <div class="card-body text-start">
        <div *ngIf="message" class="alert" [ngClass]="messageType === 'success' ? 'alert-success' : 'alert-danger'">
          {{ message }}
        </div>

        <div *ngIf="error" class="alert alert-danger">
          {{ error }}
        </div>

        <div *ngIf="loading" class="text-center py-4">
          <p>Loading...</p>
        </div>

        <div *ngIf="!loading && chapter">
          <h5 class="mb-1">{{ chapter.title }}</h5>
          <p class="text-muted mb-4">Page {{ currentPageNumber }} of {{ pageCount }}</p>

          <div class="mb-3">
            <div class="d-flex flex-wrap align-items-center gap-2">
              <strong>Pages</strong>
              <div *ngIf="pageCount > 1" class="btn-group" role="group" aria-label="Page navigation">
                <button
                  type="button"
                  class="btn btn-sm"
                  *ngFor="let n of pageNumbers"
                  (click)="goToPage(n)"
                  [ngClass]="n === currentPageNumber ? 'btn-primary' : 'btn-outline-primary'"
                  [disabled]="saving || uploading"
                >
                  {{ n }}
                </button>
              </div>

              <button class="btn btn-outline-primary btn-sm" type="button" (click)="createPage()" [disabled]="saving || uploading">
                <i class="fas fa-plus"></i> Create page
              </button>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="btn-group" role="group">
              <button class="btn btn-outline-danger btn-sm" type="button" (click)="removeCurrentPage()" [disabled]="saving || uploading || pageCount <= 1">
                Remove page
              </button>
            </div>
            <div class="btn-group" role="group">
              <button class="btn btn-outline-secondary btn-sm" type="button" (click)="movePageUp()" [disabled]="saving || uploading || pageIndex === 0">
                <i class="fas fa-arrow-up"></i>
              </button>
              <button class="btn btn-outline-secondary btn-sm" type="button" (click)="movePageDown()" [disabled]="saving || uploading || pageIndex >= pageCount - 1">
                <i class="fas fa-arrow-down"></i>
              </button>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label"><strong>Page text</strong></label>
            <textarea class="form-control" rows="6" [(ngModel)]="pageText" [disabled]="saving || uploading"></textarea>
          </div>

          <div
            class="border rounded p-3 mb-3"
            [class.bg-light]="!isDragOver"
            [class.border-primary]="isDragOver"
            (dragover)="onDragOver($event)"
            (dragleave)="onDragLeave($event)"
            (drop)="onDrop($event)"
          >
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <strong>Upload files</strong>
                <div class="text-muted">Drag & drop images/gifs/videos, or choose a file</div>
              </div>
              <div>
                <input type="file" (change)="onFileSelected($event)" [disabled]="uploading || saving" multiple />
              </div>
            </div>
            <div *ngIf="uploading" class="text-muted mt-2">Uploading...</div>
          </div>

          <div class="mb-3">
            <strong>Page assets</strong>

            <div *ngIf="pageAssets.length === 0" class="text-muted">No assets attached.</div>

            <ul *ngIf="pageAssets.length > 0" class="list-group mt-2">
              <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let asset of pageAssets; trackBy: trackAsset">
                <div>
                  <span class="badge bg-secondary me-2">{{ asset.kind }}</span>
                  <a [href]="asset.url" target="_blank" rel="noopener">{{ asset.originalName || asset.url }}</a>
                </div>
                <button class="btn btn-outline-danger btn-sm" type="button" (click)="removeAsset(asset.url)" [disabled]="saving || uploading">
                  Remove
                </button>
              </li>
            </ul>

            <div class="mt-3">
              <label class="form-label mb-1"><strong>YouTube URL</strong></label>
              <div class="input-group">
                <input
                  class="form-control"
                  [(ngModel)]="youtubeUrl"
                  [disabled]="saving || uploading"
                  placeholder="https://youtu.be/... or https://www.youtube.com/watch?v=..."
                />
                <button class="btn btn-outline-primary" type="button" (click)="addYouTubeVideo()" [disabled]="saving || uploading">
                  Add video
                </button>
              </div>
              <small class="text-muted">Adds a YouTube embed to this page (rendered in the student viewer).</small>
            </div>
          </div>

          <div class="d-flex gap-2">
            <button class="btn btn-primary" type="button" (click)="save()" [disabled]="saving || uploading">
              <i class="fas fa-save"></i> Save
            </button>
            <button class="btn btn-outline-secondary" type="button" (click)="backToCourseContent()" [disabled]="saving || uploading">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
